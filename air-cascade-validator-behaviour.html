<link rel="import" href="../polymer/polymer.html">

<script>

    /**
     * FiveElements Namespace definition
     */
    var FiveElements = FiveElements || {};


    /**
     * @polymerBehavior
     */
    FiveElements.AirCascadeValidatorBehavior = {
        properties: {},

        listeners: {
            'iron-form-element-register': '_registerValidateElement'
        },


        // --- Life Cycle
        // --- ---------------------------
        ready: function () {
            // Holds all the custom elements registered with this form.
            this._validateElements = [];
        },

        // --- Node Watcher
        // --- ---------------------------
        _registerValidateElement: function (e) {
            if (this !== e.target) {
                this._validateElements.push(e.target);
            }
        },

        // --- Validators
        // --- ---------------------------
        _validateAllNodes: function (notValidNodesCallback) {
            var childNodes = this._validateElements;
            // Compute InValid nodes
            var notValidNodes = Array.prototype.filter.call(childNodes, function (childNode) {
                if (typeof childNode.checkValidity === 'function') {
                    return !childNode.checkValidity();
                } else if (typeof childNode.validate === 'function') {
                    return !childNode.validate();
                }
                return false;
            });
            // Not Valid Callback
            if (notValidNodesCallback) {
                notValidNodesCallback(notValidNodes);
            }
            // Return
            return notValidNodes.length < 1;
        },

        validate: function (callback) {
            return this._validateAllNodes(callback);
        }

        // --- End
        // --- ---------------------------

    };
</script>
